<?php//require_once("verificar_sesion.php");require_once("verificar_sesion.php");require_once 'clases/Usuario.php';$objUser = json_decode($_SESSION['Usuario']);$queMuestro = isset($_POST['queMuestro']) ? $_POST['queMuestro'] : NULL;switch ($queMuestro) {        case "ENUNCIADO":                require_once("enunciado.php");                break;        case "MOSTRAR_GRILLA":                //var_dump($objUser);        $arrUsuarios = Usuario::TraerTodosLosUsuarios();        echo '<script type="text/javascript"> var arr = '.json_encode($arrUsuarios).'</script>';        $tabla='<table class="table">';        //CABEZA        $tabla.="<thead>";        $tabla.="<tr>";        $tabla.='<th>ID</th><th>Nombre</th><th>Email</th><th>Perfil</th><th>Foto</th><th class="text-center">Seleccion</th>';        $tabla.="</tr>";        $tabla.="</thead>";        //CUERPO        $tabla.="<tbody>";        for ($i=0; $i < count($arrUsuarios); $i++) {              $tabla .= '<tr>';                $tabla.='<td>'.$arrUsuarios[$i]->id.'</td>';                $tabla.='<td>'.$arrUsuarios[$i]->nombre.'</td>';                $tabla.='<td>'.$arrUsuarios[$i]->email.'</td>';                $tabla.='<td>'.$arrUsuarios[$i]->perfil.'</td>';                $tabla.='<td>'.$arrUsuarios[$i]->foto.'</td>';                $tabla.='<td class="text-center">';                if ($objUser->perfil != "usuario")                $tabla.='<a class="btn btn-default" onclick="boton('.$i.',1)"><span class="glyphicon glyphicon-pencil"></span></a>';                $tabla.='<a class="btn btn-danger" onclick="boton('.$i.',2)"> <span class="glyphicon glyphicon-trash"></span></a>';                 $tabla.='</td>';            $tabla.='</tr>';        }        $tabla.="</tbody>";        $tabla.="</table>";        $tabla.='<script type="text/javascript">        function boton(id,accion){            if (accion == 1) {                arr[id].accion = "Modificar";            }else                arr[id].accion = "Eliminar";            //console.log(arr[id]);                       EditarUsuario(arr[id]);        }        </script>';        echo $tabla;        break;    case "FORM"://MUESTRA FORM ALTA-MODIFICACION USUARIO        $usuario = isset($_POST["usuario"]) ? json_decode(json_encode($_POST["usuario"])) : NULL;        require_once("form.php");        break;    case "ALTA_USUARIO":        $obj = new stdClass();        $obj->Exito = TRUE;        $obj->Mensaje = "ALTA DE USUARIO EXITOSA";                //VALIDACION CAMPOS VACIOS        if (empty($_POST['nombre']) && empty($_POST['email'] && empty($_POST['password']) && empty($_POST['perfil']))) {                        $obj->Exito = FALSE;            $obj->Mensaje = "SE NECESITAN TODOS LOS CAMPOS";            echo json_encode($obj);            break;        }        //--------------------------------------------------//        $usuario = new Usuario();        $usuario->nombre = $_POST['nombre'];        $usuario->email = $_POST['email'];        $usuario->password = $_POST['password'];        $usuario->foto = $_POST['foto'];        $usuario->perfil = $_POST['perfil'];        //VALIDACION NO DUPLICAR        $arr = Usuario::TraerTodosLosUsuarios();        $bandera = TRUE;        foreach ($arr as $user) {            if ($user->email == $usuario->email) {                $bandera = FALSE;            }        }        if (!$bandera) {                          $obj->Exito = FALSE;            $obj->Mensaje = "YA SE ENCUENTRA UNA CUENTA CREADA COMO: ".$usuario->email;            echo json_encode($obj);            break;        }        //--------------------------------------------------//        //ALTA DE USUARIO        if (!Usuario::Agregar($usuario)) {            $obj->Exito = FALSE;            $obj->Mensaje = "OCURRIO UN ERROR INESPERADO NO SE PUDO AGREGAR EL NUEVO USUARIO";            echo json_encode($obj);            break;        }        //--------------------------------------------------//        echo json_encode($obj);        break;    case "MODIFICAR_USUARIO":                //var_dump($_POST);        $obj = new stdClass();        $obj->Exito = TRUE;        $obj->Mensaje = "SE LOGRO MODIFICAR AL USUARIO";        $modificacionUsuario = $_POST['usuario']; //VALORES A MODIFICAR        //VALIDACION NO DUPLICAR        $arr = Usuario::TraerTodosLosUsuarios(); // TRAIGO TODOS Y COMPARO        $bandera = TRUE;        foreach ($arr as $user) {            if ($user->id != $modificacionUsuario['id']) { //SI EL ID ES DISTINTO COMPARAME EL NOMBRE                                if ($user->email == $modificacionUsuario['email']) { //SI OTRO USUARIO TIENE EL MISMO NOMBRE => NO                                     $bandera = FALSE;                }            }        }        if (!$bandera) {                          $obj->Exito = FALSE;            $obj->Mensaje = "LO SENTIMOS YA DR ENCUENTRA UNA CUENTA CREADA COMO: ".$modificacionUsuario['email'];            echo json_encode($obj);            break;        }        //--------------------------------------------------//        //MODIFICANDO        $objUser = new Usuario($modificacionUsuario['id']); //TRAEME EL DE LA BASE DE DATOS        // SOLO REMPLAZO LOS CAMPOS QUE ESTEN COMPLETOS        if (!empty($modificacionUsuario['nombre'])) $objUser->nombre = $modificacionUsuario['nombre'];        if (!empty($modificacionUsuario['email'])) $objUser->email = $modificacionUsuario['email'];        if (!empty($modificacionUsuario['perfil'])) $objUser->perfil = $modificacionUsuario['perfil'];        if (!empty($modificacionUsuario['foto'])) $objUser->foto = $modificacionUsuario['foto'];        if (!empty($modificacionUsuario['password'])) $objUser->password = $modificacionUsuario['password'];        //var_dump($objUser);        if (!Usuario::Modificar($objUser)) {            $obj->Exito = FALSE;            $obj->Mensaje = "OCURRIO UN ERROR INESPERADO NO SE PUDO MODIFICAR EL USUARIO";            echo json_encode($obj);            break;        }        //implementar...        echo json_encode($obj);        break;            case "ELIMINAR_USUARIO":        $obj = new stdClass();        $obj->Exito = TRUE;        $obj->Mensaje = "SE BORRO SATISFACTORIAMENTE EL USUARIO";        $id = $_POST['usuario']['id'];        if (!Usuario::Borrar($id)) {            $obj->Exito = FALSE;            $obj->Mensaje = "OCURRIO UN ERROR INESPERADO NO SE PUDO BORRAR EL USUARIO";        }        //implementar...        echo json_encode($obj);        break;    case "LOGOUT":        //implementar...        $_SESSION['Usuario'] = NULL;        session_destroy();        break;    case "TRAER_CDS":    require_once('clases/lib/nusoap.php');    $obj = new stdClass();    $obj->Exito = TRUE;    $obj->Mensaje = "LOGRE TRAER LOS CDS";    $host = 'http://localhost/php/SERVIDOR/wscds.php';    $client = new nusoap_client($host.'?wsdl');    $err = $client->getError();        if ($err) {            $obj->Mensaje='ERROR EN LA CONSTRUCCION DEL WS: ' . $err;            die();        }    $arrUsuarios = $client->call('ObtenerTodosLosCds', array());    if ($client->fault) {            $obj->Mensaje='ERROR AL INVOCAR METODO: '. print_r($arrUsuarios);    } else {        $err = $client->getError();        if ($err) {            $obj->Mensaje='ERROR EN EL CLIENTE: '. $err;        }else        {            $obj->Exito = FALSE;            $obj->html = '<table class="table">';            //CABEZA            $obj->html.="<thead>";            $obj->html.="<tr>";            $obj->html.='<th>ID</th><th>Interprete</th><th>AÃ±o</th><th>Titulo</th>';            $obj->html.="</tr>";            $obj->html.="</thead>";            //CUERPO            $obj->html.="<tbody>";            foreach ($arrUsuarios as $usuario) {                $obj->html .= '<tr>';                    $obj->html.='<td>'.$usuario['id'].'</td>';                    $obj->html.='<td>'.$usuario['interpret'].'</td>';                    $obj->html.='<td>'.$usuario['jahr'].'</td>';                    $obj->html.='<td>'.$usuario['titel'].'</td>';                $obj->html .= '</tr>';            }            $obj->html.="</tbody>";            $obj->html.="</table>";        }    }    echo json_encode($obj);        break;    case "SET_COOKIE":            $cookie_nombre = 'Usuario';        $cookie_valor = json_encode(json_decode($_SESSION['Usuario']));        setcookie($cookie_nombre,$cookie_valor, time() + 30, "/");        break;    default:        echo ":(";}?>